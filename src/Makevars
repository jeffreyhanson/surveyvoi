# package root
PKGROOT=.
ENABLE_STD_THREAD=0
# _*_ mode: Makefile; _*_

CXX_STD = CXX11

XGB_RFLAGS = -DXGBOOST_STRICT_R_MODE=1 -DDMLC_LOG_BEFORE_THROW=0\
             -DDMLC_ENABLE_STD_THREAD=$(ENABLE_STD_THREAD)\
             -DDMLC_DISABLE_STDIN=1\
             -DDMLC_LOG_CUSTOMIZE=1 -DXGBOOST_CUSTOMIZE_LOGGER=1\
             -DRABIT_CUSTOMIZE_MSG_ -DRABIT_STRICT_CXX98_

## not needed since this will only work on Linux
# disable the use of thread_local for 32 bit windows:
# ifeq ($(R_OSTYPE)$(WIN),windows)
#    XGB_RFLAGS += -DDMLC_CXX11_THREAD_LOCAL=0
# endif

$(foreach v, $(XGB_RFLAGS), $(warning $(v)))

# xgboost and gurobi configuration
PKG_CPPFLAGS = -I$(PKGROOT)/include\
               -I$(PKGROOT)/dmlc-core/include\
               -I$(PKGROOT)/rabit/include\
               -I$(PKGROOT)\
               $(XGB_RFLAGS)\
               -I../inst/include/ -I"${GUROBI_HOME}/include" -lm
PKG_CXXFLAGS = $(SHLIB_OPENMP_CXXFLAGS) -pthread
PKG_LIBS = $(SHLIB_OPENMP_CXXFLAGS) -pthread\
           -L"${GUROBI_HOME}/lib" -lgurobi_c++ -lgurobi81 -lgmp -lgmpxx

# define objects
OBJECTS =\
  $(PKGROOT)/init.o\
  $(PKGROOT)/rcpp_expected_value_of_management_decision_given_perfect_information.o\
  $(PKGROOT)/rcpp_approximate_expected_value_of_management_decision_given_perfect_information.o\
  $(PKGROOT)/rcpp_approximate_expected_value_of_management_decision_given_current_information.o\
  $(PKGROOT)/functions.o\
  $(PKGROOT)/rcpp_states.o\
  $(PKGROOT)/rcpp_probability.o\
  $(PKGROOT)/rcpp_feasible_actions_ilp_matrix.o\
  $(PKGROOT)/rcpp_pmedian_constraint_matrix.o\
  $(PKGROOT)/rcpp_expected_value_of_management_action.o\
  $(PKGROOT)/rcpp_approximate_expected_value_of_management_action.o\
  $(PKGROOT)/rcpp_xgboost.o\
  $(PKGROOT)/rcpp_prioritization.o\
  $(PKGROOT)/rcpp_expected_value_of_management_decision_given_current_information.o\
  $(PKGROOT)/RcppExports.o\
  ./xgboost_R.o ./xgboost_custom.o ./xgboost_assert.o\
  $(PKGROOT)/amalgamation/xgboost-all0.o\
  $(PKGROOT)/amalgamation/dmlc-minimum0.o\
  $(PKGROOT)/rabit/src/engine_empty.o\
  $(PKGROOT)/rabit/src/c_api.o
