<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Approximation Benchmark • surveyvoi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Approximation Benchmark">
<meta property="og:description" content="surveyvoi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surveyvoi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/approximation.html">Approximation Benchmark</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulation Study</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jeffreyhanson/surveyvoi/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Approximation Benchmark</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jeffreyhanson/surveyvoi/blob/master/vignettes/approximation.Rmd"><code>vignettes/approximation.Rmd</code></a></small>
      <div class="hidden name"><code>approximation.Rmd</code></div>

    </div>

    
    
<p>Here we will examine the approximation method for value of information analyses. To achieve this, we will compare estimates from the approximation method against the correct values from the exact methods. A crucial part of the approximation method involves generating a subset of outcomes to <em>approximate</em> the full set of outcomes, and so we will investigate several different methods for generating outcomes. We will also examine how the number of approximation outcomes affects the quality of the estimate.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>Let’s start by setting up our R session. Here we will load some R packages and pre-set the random number generators for reproducibility.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">surveyvoi</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gridExtra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">viridis</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RandomFields</span>)

<span class="co"># set RNG seeds for reproducibility</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">505</span>)
<span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RFoptions.html">RFoptions</a></span>(<span class="kw">seed</span> <span class="kw">=</span> <span class="fl">505</span>)

<span class="co"># set default table printing options</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">pillar.sigfig</span> <span class="kw">=</span> <span class="fl">6</span>)</pre></body></html></div>
</div>
<div id="simulate-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate data</h2>
<p>Let’s simulate some data. To keep things simple, we will simulate data for 10 sites and 1 conservation feature (e.g. species). Of the 15 sites in total, we will simulate survey data for 10 sites—meaning that 5 sites will not have survey data.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># simulate site data</span>
<span class="no">site_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/simulate_site_data.html">simulate_site_data</a></span>(
  <span class="kw">n_sites</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">n_features</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">proportion_of_sites_missing_data</span> <span class="kw">=</span> <span class="fl">5</span> / <span class="fl">15</span>)</pre></body></html></div>
<pre><code>## ...</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># print site data</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">site_data</span>)</pre></body></html></div>
<pre><code>## Simple feature collection with 15 features and 7 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 0.02070792 ymin: 0.01366063 xmax: 0.7855831 ymax: 0.9272025
## CRS:            NA
## # A tibble: 15 x 8
##    survey_cost management_cost         e1         e2        e3    f1         p1
##          &lt;dbl&gt;           &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     8.78717         69.5624  0.352685  -0.615935  -0.728549     0 4.60086e-1
##  2     5.36696         64.8589 -0.612633   1.15596    0.718512    NA 2.69503e-1
##  3     6.25925         57.5309 -1.53741   -0.281868   1.29149     NA 9.95906e-1
##  4     8.81519         66.1143  1.14228   -1.24025   -0.839952     1 5.56238e-1
##  5     5.45039         62.7456 -1.01539   -0.409767   0.518910     1 9.74110e-1
##  6     4.37280         60.5701  1.43650    2.52796   -0.253192     0 6.06472e-5
##  7     8.76247         67.2501  0.0259090 -0.402047  -0.519918    NA 5.28076e-1
##  8     8.80315         65.1071  0.838224  -0.894822  -0.878425     0 4.08044e-1
##  9     9.57884         66.6267  0.347615  -0.0776230 -0.635106    NA 1.83623e-1
## 10     6.37048         65.9617  1.08574   -0.560094  -0.813593     0 1.74159e-1
## 11     8.75928         67.5310  0.496681   0.0117405 -0.682279     1 1.13847e-1
## 12     9.58011         64.8944  0.722107  -0.580667  -0.846134    NA 2.64076e-1
## 13     5.49527         58.2507 -1.44014   -0.152584   1.18873      1 9.91781e-1
## 14     7.11370         64.8953 -0.608469  -0.0494300  0.128359     1 7.81913e-1
## 15     5.19364         70.5367 -1.23370    1.56944    2.35114      0 8.62330e-1
## # … with 1 more variable: geometry &lt;POINT&gt;</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot the spatial location of the sites</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">site_data</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"sites"</span>)</pre></body></html></div>
<p><img src="approximation_files/figure-html/unnamed-chunk-4-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The <code>site_data</code> object is a spatially explicit dataset (i.e. <code>sf</code>) that contains information on the site locations and additional information for each site too. Here, each row corresponds to a different site and each column contains different information about the sites. The <code>f1</code> column contains the results from previous surveys, where ones indicate that the feature was previously detected at a site, zeros indicate that the feature has not previously been detected at a site, and missing (<code>NA</code>) values mean that a site has not yet been surveyed. The <code>p1</code> column contains modelled probability of occupancy predictions from environmental niche models. The <code>e1</code>, <code>e2</code>, and <code>e3</code> columns contain environmental variables for each site. The <code>survey_cost</code> column contains the cost for surveying each site, and the <code>management_cost</code> column contains the cost for managing each site for conservation. Although the <code>site_data</code> object contains additional columns, they are not relevant here and so we will not bother with them. To help understand the simulated data, let’s create some visualizations.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># map of site occupancy data from previous surveys</span>
<span class="no">p1</span> <span class="kw">&lt;-</span>
  <span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">f1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">f1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">f1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"1"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"0"</span> <span class="kw">=</span> <span class="st">"black"</span>),
                     <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">"blue"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"presence/absence data"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)

<span class="co"># make map of modelled probability of occupancy data</span>
<span class="no">p2</span> <span class="kw">&lt;-</span>
  <span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">p1</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"probability data"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)

<span class="co"># make map of site occupancy data from previous surveys</span>
<span class="no">p3</span> <span class="kw">&lt;-</span>
  <span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">management_cost</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">""</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"management costs"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)

<span class="co"># display plots</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">p1</span>, <span class="no">p2</span>, <span class="no">p3</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="approximation_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Next, we will simulate a survey scheme. This survey scheme will contain four of the five sites that have not previously been surveyed.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># generate survey scheme</span>
<span class="no">site_data</span>$<span class="no">survey_scheme</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">FALSE</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">site_data</span>)), <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">site_data</span>$<span class="no">f1</span>)), <span class="fl">4</span>),
          <span class="fl">TRUE</span>)

<span class="co"># print survey scheme</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">site_data</span>$<span class="no">survey_scheme</span>)</pre></body></html></div>
<pre><code>##  [1] FALSE  TRUE  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE
## [13] FALSE FALSE FALSE</code></pre>
<p>We will also set a total budget for surveying sites and managing sites for conservation. This budget will be 80% of the total costs of all planning units.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># set total budget</span>
<span class="no">total_budget</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">site_data</span>$<span class="no">management_cost</span>) * <span class="fl">0.8</span>

<span class="co"># print total budget</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">total_budget</span>)</pre></body></html></div>
<pre><code>## [1] 777.9488</code></pre>
<p>After simulating data for the sites, we will simulate data for the conservation feature.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># simulate feature data</span>
<span class="no">feature_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/simulate_feature_data.html">simulate_feature_data</a></span>(
  <span class="kw">n_features</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">proportion_of_survey_features</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co"># print feature data</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">feature_data</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1 x 9
##   name  survey survey_sensitiv… survey_specific… model_sensitivi…
##   &lt;chr&gt; &lt;lgl&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 f1    TRUE           0.959335         0.895506         0.778723
## # … with 4 more variables: model_specificity &lt;dbl&gt;, preweight &lt;dbl&gt;,
## #   postweight &lt;dbl&gt;, target &lt;dbl&gt;</code></pre>
<p>The <code>feature_data</code> object is a table (i.e. <code>tibble</code>) that contains information on the conservation feature. Here, each row corresponds to a different feature – and so it only has one row because we only have one feature – and each column contains different information about the feature(s). The <code>name</code> column contains the name of the feature. The <code>preweight</code>, <code>postweight</code>, and <code>target</code> columns contain values that specify the conservation benefit gained when sites are managed for conservation. The <code>survey_sensitivity</code> and <code>survey_specificity</code> columns denote the sensitivity (probability of correctly detecting a presence) and specificity (probability of correctly detecting an absence) of the survey methodology. Finally, the <code>model_sensitivity</code> and <code>model_specificity</code> columns denote the sensitivity and specificity of the model used to predict the occupancy probabilities in the <code>site_data</code> object (i.e. values in the <code>p1</code> column).</p>
<p>Furthermore, our calculations will involve fitting new species distribution models and so we will define some parameters for model fitting. Generally, these parameters would be obtained using the <code>fit_occupancy_models</code> function, but here we will define them manually to keep things simple.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># define parameters</span>
<span class="no">xgb_parameters</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">eta</span> <span class="kw">=</span> <span class="fl">0.3</span>, <span class="kw">nrounds</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">objective</span> <span class="kw">=</span> <span class="st">"binary:logistic"</span>,
  <span class="kw">scale_pos_weight</span> <span class="kw">=</span> <span class="fl">1</span>))</pre></body></html></div>
</div>
<div id="benchmark-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmark-analysis" class="anchor"></a>Benchmark analysis</h2>
<p>After simulating the data, we can conduct our benchmark analysis. Our simulated data contains one feature and ten planning units in total. This means that there is a total of 32 outcomes. Since we are interested in understanding how the number outcomes in the approximation method affects its accuracy, we will create a set of containing different numbers of outcomes (i.e. <code>n_approx_outcomes</code>).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create set of number of approximation outcomes</span>
<span class="no">n_approx_outcomes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">ceiling</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">10</span>, <span class="fu"><a href="../reference/n_states.html">n_states</a></span>(<span class="fl">1</span>, <span class="fl">5</span>), <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">10</span>))

<span class="co"># print outcomes</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">n_approx_outcomes</span>)</pre></body></html></div>
<pre><code>##  [1] 10 13 15 18 20 23 25 28 30 32</code></pre>
<p>This benchmark analysis will examine various approaches for approximating the <em>expected value of the decision given survey information</em>. To evaluate the accuracy of the approximation calculations, we will calculate exactly what this number should be given the simulated data.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate the correct value of the decision given survey information using</span>
<span class="co"># exact methods</span>
<span class="no">ev_survey</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evdsi.html">evdsi</a></span>(
  <span class="kw">site_data</span> <span class="kw">=</span> <span class="no">site_data</span>,
  <span class="kw">feature_data</span> <span class="kw">=</span> <span class="no">feature_data</span>,
  <span class="kw">site_occupancy_columns</span> <span class="kw">=</span> <span class="st">"f1"</span>,
  <span class="kw">site_probability_columns</span> <span class="kw">=</span> <span class="st">"p1"</span>,
  <span class="kw">site_env_vars_columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"e1"</span>, <span class="st">"e2"</span>, <span class="st">"e3"</span>),
  <span class="kw">site_survey_scheme_column</span> <span class="kw">=</span> <span class="st">"survey_scheme"</span>,
  <span class="kw">site_survey_cost_column</span> <span class="kw">=</span> <span class="st">"survey_cost"</span>,
  <span class="kw">site_management_cost_column</span> <span class="kw">=</span> <span class="st">"management_cost"</span>,
  <span class="kw">feature_survey_column</span> <span class="kw">=</span> <span class="st">"survey"</span>,
  <span class="kw">feature_survey_sensitivity_column</span> <span class="kw">=</span> <span class="st">"survey_sensitivity"</span>,
  <span class="kw">feature_survey_specificity_column</span> <span class="kw">=</span> <span class="st">"survey_specificity"</span>,
  <span class="kw">feature_model_sensitivity_column</span> <span class="kw">=</span> <span class="st">"model_sensitivity"</span>,
  <span class="kw">feature_model_specificity_column</span> <span class="kw">=</span> <span class="st">"model_specificity"</span>,
  <span class="kw">feature_preweight_column</span> <span class="kw">=</span> <span class="st">"preweight"</span>,
  <span class="kw">feature_postweight_column</span> <span class="kw">=</span> <span class="st">"postweight"</span>,
  <span class="kw">feature_target_column</span> <span class="kw">=</span> <span class="st">"target"</span>,
  <span class="kw">total_budget</span> <span class="kw">=</span> <span class="no">total_budget</span>,
  <span class="kw">xgb_parameters</span> <span class="kw">=</span> <span class="no">xgb_parameters</span>)

<span class="co"># print value</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ev_survey</span>)</pre></body></html></div>
<pre><code>## [1] 129.4626</code></pre>
<p>Next, we will benchmark the approximation methods for calculating the expected value of the decision given current information using the simulated data. Here, we will examine four methods for generating outcomes: <em>uniform with replacement</em>, <em>uniform without replacement</em>, <em>weighted with replacement</em>, and <em>weighted without replacement</em>. The uniform methods randomly sample outcomes and do not consider the prior probability of each outcome occurring. The weighted methods, on the other hand, are select outcomes that have a greater chance of occurring. To account for stochasticity in the approximation methods – i.e. each run will give a different answer depending on the outcome of the random number generator – we will report means and standard errors for 25 replicates per number of approximation outcomes. Furthermore since the <em>weighted without replacement</em> method is computationally inefficient for generating subsets that contain a high proportion of the total outcomes, we will not explore the full range of subsets for this method.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># define function for calculating standard error</span>
<span class="no">se</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">x</span>) / <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">x</span>))

<span class="co"># estimate the correct value of the decision given survey information using</span>
<span class="co"># approximation methods</span>
<span class="no">ev_prime_survey</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw">method</span> <span class="kw">=</span>
    <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"uniform_with_replacement"</span>, <span class="st">"uniform_without_replacement"</span>,
      <span class="st">"weighted_with_replacement"</span>, <span class="st">"weighted_without_replacement"</span>),
  <span class="kw">n</span> <span class="kw">=</span> <span class="no">n_approx_outcomes</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(!((<span class="no">method</span> <span class="kw">==</span> <span class="st">"weighted_without_replacement"</span>) <span class="kw">&amp;</span>
           (<span class="no">n</span> <span class="kw">&gt;=</span> (<span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">max</a></span>(<span class="no">n_approx_outcomes</span>) * <span class="fl">0.5</span>)))) <span class="kw">%&gt;%</span>
  <span class="kw pkg">plyr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html">ddply</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"method"</span>, <span class="st">"n"</span>), <span class="kw">function</span>(<span class="no">x</span>) {
    <span class="no">result</span> <span class="kw">&lt;-</span>
      <span class="fu"><a href="../reference/approx_evdsi.html">approx_evdsi</a></span>(
        <span class="kw">site_data</span> <span class="kw">=</span> <span class="no">site_data</span>,
        <span class="kw">feature_data</span> <span class="kw">=</span> <span class="no">feature_data</span>,
        <span class="kw">site_occupancy_columns</span> <span class="kw">=</span> <span class="st">"f1"</span>,
        <span class="kw">site_probability_columns</span> <span class="kw">=</span> <span class="st">"p1"</span>,
        <span class="kw">site_env_vars_columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"e1"</span>, <span class="st">"e2"</span>, <span class="st">"e3"</span>),
        <span class="kw">site_survey_scheme_column</span> <span class="kw">=</span> <span class="st">"survey_scheme"</span>,
        <span class="kw">site_survey_cost_column</span> <span class="kw">=</span> <span class="st">"survey_cost"</span>,
        <span class="kw">site_management_cost_column</span> <span class="kw">=</span> <span class="st">"management_cost"</span>,
        <span class="kw">feature_survey_column</span> <span class="kw">=</span> <span class="st">"survey"</span>,
        <span class="kw">feature_survey_sensitivity_column</span> <span class="kw">=</span> <span class="st">"survey_sensitivity"</span>,
        <span class="kw">feature_survey_specificity_column</span> <span class="kw">=</span> <span class="st">"survey_specificity"</span>,
        <span class="kw">feature_model_sensitivity_column</span> <span class="kw">=</span> <span class="st">"model_sensitivity"</span>,
        <span class="kw">feature_model_specificity_column</span> <span class="kw">=</span> <span class="st">"model_specificity"</span>,
        <span class="kw">feature_preweight_column</span> <span class="kw">=</span> <span class="st">"preweight"</span>,
        <span class="kw">feature_postweight_column</span> <span class="kw">=</span> <span class="st">"postweight"</span>,
        <span class="kw">feature_target_column</span> <span class="kw">=</span> <span class="st">"target"</span>,
        <span class="kw">total_budget</span> <span class="kw">=</span> <span class="no">total_budget</span>,
        <span class="kw">n_approx_replicates</span> <span class="kw">=</span> <span class="fl">25</span>,
        <span class="kw">n_approx_outcomes_per_replicate</span> <span class="kw">=</span> <span class="no">x</span>$<span class="no">n</span>,
        <span class="kw">method_approx_outcomes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">x</span>$<span class="no">method</span>),
        <span class="kw">xgb_parameters</span> <span class="kw">=</span> <span class="no">xgb_parameters</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">n</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">result</span>), <span class="kw">se</span> <span class="kw">=</span> <span class="fu">se</span>(<span class="no">result</span>))
  }) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">lower</span> <span class="kw">=</span> <span class="no">mean</span> - <span class="no">se</span>, <span class="kw">upper</span> <span class="kw">=</span> <span class="no">mean</span> + <span class="no">se</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"_"</span>, <span class="st">" "</span>, <span class="no">method</span>, <span class="kw">fixed</span> <span class="kw">=</span> <span class="fl">TRUE</span>))</pre></body></html></div>
<p>Now, let’s visualize the results.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="no">ev_survey</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="st">"#3366FF"</span>) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">n</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="no">ev_prime_survey</span>) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">n</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">upper</span>), <span class="no">ev_prime_survey</span>) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">method</span>, <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">1</span>) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Number of outcomes used in approximation calculations"</span>) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Expected value of the decision given survey information"</span>) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"black"</span>),
      <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"white"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">12</span>))</pre></body></html></div>
<p><img src="approximation_files/figure-html/unnamed-chunk-13-1.png" width="504" style="display: block; margin: auto;"></p>
<p>Broadly speaking, we can see that the estimates (points) get closer to the correct value (blue line) when more outcomes are used in the approximation calculations (greater values on the x-axis). Furthermore, we can see that the estimates become more precise (smaller error bars) when more outcomes are used in the approximation calculations (greater values on the x-axis). This pattern is true for most of the sampling methods – except for the <em>weighted with replacement</em> method which performs really poorly – and shows that most the approximation method is more accurate when we use a greater number of outcomes for the calculations. In particular, we can see that the <em>weighted without replacement</em> method is the most useful because it converges to the correct value (blue line) with the fewest approximation outcomes.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://jeffrey-hanson.com">Jeffrey O Hanson</a>, <a href="https://josephrbennett.wordpress.com">Joseph Bennett</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
