<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulation Study • surveyvoi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulation Study">
<meta property="og:description" content="surveyvoi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surveyvoi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.70</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simulation.html">Simulation Study</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jeffreyhanson/surveyvoi/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulation Study</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jeffreyhanson/surveyvoi/blob/master/vignettes/simulation.Rmd"><code>vignettes/simulation.Rmd</code></a></small>
      <div class="hidden name"><code>simulation.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The resources available for conservation are limited. To ensure that conservation resources are allocated cost-effectively, conservation plans (termed prioritizations) can be developed – using a combination of economic, biodiversity, and land-use data – to prioritize a set of sites for conservation management (e.g. protected area establishment). However, existing data on biodiversity patterns is incomplete. As a consequence, spatial prioritizations can potentially be improved by collecting additional data (e.g. surveying sites to refine estimates of which species are present inside them). However, this is complicated by the fact that surveying sites consumes limited resources that also need to be used for conservation management. Thus decision makers need to strategically prioritize sites for surveys that will substantially improve spatial prioritisations—this is not a trivial task.</p>
<p>The <em>surveyvoi</em> package is decision support tool for prioritizing sites for surveys based on their potential to improve spatial prioritizations for managing biodiversity. Given a set of sites that could potentially be acquired for conservation management – wherein some sites have previously been surveyed and other sites have not – this package aims to identify which sites should be surveyed because doing so could lead to vastly superior conservation management plans (i.e. the management <em>decision</em>). Methods are provided to calculate the <em>expected value of the decision given current information</em>, and the <em>expected value of the decision given a survey scheme</em> (using exact methods for small problems, and approximation methods for large problems). Furthermore, by examining survey schemes, optimal survey schemes can be identified. In this vignette, we will use a simulated dataset to explore these methods.</p>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>Let’s start by setting up our R session. Here we will load some R packages and pre-set the random number generators for reproducibility.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">surveyvoi</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gridExtra</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">viridis</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RandomFields</span>)

<span class="co"># set RNG seeds for reproducibility</span>
<span class="no">seed</span> <span class="kw">&lt;-</span> <span class="fl">715</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="no">seed</span>)
<span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RFoptions.html">RFoptions</a></span>(<span class="kw">seed</span> <span class="kw">=</span> <span class="no">seed</span>)

<span class="co"># set default table printing options</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">pillar.sigfig</span> <span class="kw">=</span> <span class="fl">6</span>)</pre></body></html></div>
</div>
<div id="simulate-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate data</h2>
<p>Let’s simulate some data. To keep things simple, we will simulate data for 30 sites and one conservation feature (e.g. species). Of the 30 sites in total, we will simulate survey data for 18 sites—meaning that 12 of the sites will not have survey data. We will also simulate two spatially auto-correlated variables to characterise the environmental conditions within the sites. Although the simulation code (i.e. <code>simulate_site_data</code>) can output the probability that features are expected to inhabit the sites, we will disable this option to make our simulation study more realistic and instead predict these probabilities using statistical models.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># simulate site data</span>
<span class="no">site_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/simulate_site_data.html">simulate_site_data</a></span>(
  <span class="kw">n_sites</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">n_features</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">proportion_of_sites_missing_data</span> <span class="kw">=</span> <span class="fl">12</span> / <span class="fl">30</span>,
  <span class="kw">n_env_vars</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">max_number_surveys_per_site</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">output_probabilities</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## ...</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># print site data</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">site_data</span>)</pre></body></html></div>
<pre><code>## Simple feature collection with 30 features and 7 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 0.04928101 ymin: 0.02242576 xmax: 0.9836789 ymax: 0.9957509
## CRS:            NA
## # A tibble: 30 x 8
##    survey_cost management_cost    f1    n1        e1         e2        e3
##          &lt;dbl&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1     5.37503         71.4770     1     1 -1.16175  -0.820554   0.444516
##  2     4.40311         63.7324     0     0  1.05826  -1.28770    0.139157
##  3     7.83981         73.0621     1     1 -0.736609  0.733109   1.03653 
##  4    11.4662          66.1679     0     0  1.77391   1.20038   -2.27371 
##  5     5.50316         67.9276     0     0 -1.67395  -0.408138   0.376850
##  6     8.67965         74.8280     0     1 -0.905815  0.978526   0.759205
##  7     7.24226         69.5557     1     1  0.384206 -0.158379   0.515493
##  8    11.7712          68.0428     0     1  0.728228  0.671176  -0.964622
##  9    10.5117          64.9664     0     0  1.29645   0.0114602 -0.746961
## 10     6.05228         72.7030     1     1 -1.13688   0.919918   1.70807 
## # … with 20 more rows, and 1 more variable: geometry &lt;POINT&gt;</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot the spatial location of the sites</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">site_data</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"sites"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-5-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The <code>site_data</code> object is a spatially explicit dataset (i.e. <code>sf</code> object) that contains information on the site locations and additional information for each site too. Here, each row corresponds to a different site and each column contains different information about the sites. The <code>f1</code> column contains the results from previous surveys, where values describe the proportion of previous surveys where species were previously detected at each site. Since each site only has a single previous survey at most, these data contain zeros (indicating that the species has not been detected) and ones (indicating that the species has been detected). The <code>n1</code> column contains the number of previous surveys conducted within each site. Thus sites with zeros in this column have not previously been surveyed. The <code>e1</code>, <code>e2</code>, and <code>e3</code> columns contain environmental information for each site (e.g. normalized temperature and rainfall data). The <code>survey_cost</code> column contains the cost for surveying each site, and the <code>management_cost</code> column contains the cost for managing each site for conservation.</p>
<p>To help understand the simulated data, let’s create some visualizations.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot site occupancy data from previous surveys</span>
<span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">f1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">f1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">f1</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"1"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"0"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"detection/non-detection data"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-6-1.png" width="336" style="display: block; margin: auto;"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot number of previous surveys within each site</span>
<span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">n1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">n1</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">n1</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"1"</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="st">"0"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"number of previous surveys data"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-7-1.png" width="336" style="display: block; margin: auto;"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot site cost data</span>
<span class="co"># note that survey and management costs are on different scales</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">site_data</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">survey_cost</span>)) +
      <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>() +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"survey cost"</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">site_data</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">management_cost</span>)) +
      <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>() +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"management cost"</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="no">p1</span>, <span class="no">p2</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-8-1.png" width="604.8" style="display: block; margin: auto;"></p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># plot site environmental data</span>
<span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://tidyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"e"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="no">var</span>, <span class="no">value</span>, -<span class="no">geometry</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">value</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">var</span>) +
    <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"environmental conditions"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-9-1.png" width="504" style="display: block; margin: auto;"></p>
<p>After simulating data for the sites, we will simulate data for the conservation feature.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># simulate feature data</span>
<span class="no">feature_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/simulate_feature_data.html">simulate_feature_data</a></span>(
  <span class="kw">n_features</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">proportion_of_survey_features</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co"># manually set target</span>
<span class="no">feature_data</span>$<span class="no">target</span> <span class="kw">&lt;-</span> <span class="fl">15</span>

<span class="co"># print feature data</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">feature_data</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1 x 7
##   name  survey survey_sensitiv… survey_specific… model_sensitivi…
##   &lt;chr&gt; &lt;lgl&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 f1    TRUE           0.965532         0.861344         0.776341
## # … with 2 more variables: model_specificity &lt;dbl&gt;, target &lt;dbl&gt;</code></pre>
<p>The <code>feature_data</code> object is a table (i.e. <code>tibble</code> object) that contains information on the conservation feature. Here, each row corresponds to a different feature – and so it only has one row because we only have one feature – and each column contains different information about the feature(s). The <code>name</code> column contains the name of the feature. The <code>survey</code> column indicates if the feature will be examined in future surveys. The <code>target</code> column specifies the amount of occupied sites for each species that should ideally be represented by the prioritization. Finally, the <code>sensitivity</code> and <code>specificity</code> columns denote the sensitivity (probability of correctly detecting a presence) and specificity (probability of correctly detecting an absence) of the survey methodology.</p>
</div>
<div id="modelling-probability-of-occupancy" class="section level2">
<h2 class="hasAnchor">
<a href="#modelling-probability-of-occupancy" class="anchor"></a>Modelling probability of occupancy</h2>
<p>After simulating the data, we need to estimate the probability of the feature occurring in the unsurveyed sites. This is important for calculating the return on investment of surveying sites, because if we can reliably predict the probability of the feature(s) occurring in unsurveyed sites using models then we may not need to survey them. Specifically, we will fit gradient boosted regression trees – via the <a href="https://xgboost.readthedocs.io/en/latest/">xgboost R package</a> – using functions contained in this package. These models are well-suited for modelling species distributions because they can accommodate high order interactions among different predictor variables that are needed to effectively model species’ environmental niches.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create list of candidate parameter value for calibration procedure</span>
<span class="no">xgb_parameters</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">eta</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">lambda</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">objective</span> <span class="kw">=</span> <span class="st">"binary:logistic"</span>)

<span class="co"># identify suitable parameters for model fitting</span>
<span class="co"># ideally, we would try a larger range of values,</span>
<span class="co"># but we will keep it low to reduce processing time for this example</span>
<span class="no">xgb_results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_xgb_occupancy_models.html">fit_xgb_occupancy_models</a></span>(
  <span class="no">site_data</span>, <span class="no">feature_data</span>,
  <span class="st">"f1"</span>, <span class="st">"n1"</span>, <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"e1"</span>, <span class="st">"e2"</span>, <span class="st">"e3"</span>),
  <span class="st">"survey_sensitivity"</span>, <span class="st">"survey_specificity"</span>,
  <span class="kw">n_folds</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">xgb_tuning_parameters</span> <span class="kw">=</span> <span class="no">xgb_parameters</span>)</pre></body></html></div>
<p>After fitting the models, we can examine the tuning parameters used to fit the models, extract the modelled probability of occupancy, and evaluate the performance of the models.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># print best parameters</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">xgb_results</span>$<span class="no">parameters</span>)</pre></body></html></div>
<pre><code>## [[1]]
## [[1]]$eta
## [1] 0.1
## 
## [[1]]$lambda
## [1] 0.1
## 
## [[1]]$objective
## [1] "binary:logistic"
## 
## [[1]]$scale_pos_weight
## [[1]]$scale_pos_weight[[1]]
## [1] 1 1</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># print model performance (TSS value)</span>
<span class="no">xgb_performance</span> <span class="kw">&lt;-</span> <span class="no">xgb_results</span>$<span class="no">performance</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">xgb_performance</span>))</pre></body></html></div>
<pre><code>##   feature train_tss_mean train_tss_std train_sensitivity_mean
## 1      f1              1             0                      1
##   train_sensitivity_std train_specificity_mean train_specificity_std
## 1                     0                      1                     0
##   test_tss_mean test_tss_std test_sensitivity_mean test_sensitivity_std
## 1     0.8788582    0.1713204                     1                    0
##   test_specificity_mean test_specificity_std
## 1             0.8788582            0.1713204</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># store the model sensitivities and specificities in the feature_data object</span>
<span class="no">feature_data</span>$<span class="no">model_sensitivity</span> <span class="kw">&lt;-</span> <span class="no">xgb_performance</span>$<span class="no">test_sensitivity_mean</span>
<span class="no">feature_data</span>$<span class="no">model_specificity</span> <span class="kw">&lt;-</span> <span class="no">xgb_performance</span>$<span class="no">test_specificity_mean</span>

<span class="co"># store predicted probabilities values in the site_data object</span>
<span class="no">xgb_predictions</span> <span class="kw">&lt;-</span> <span class="no">xgb_results</span>$<span class="no">predictions</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">xgb_predictions</span>)</pre></body></html></div>
<pre><code>## # A tibble: 30 x 1
##          f1
##       &lt;dbl&gt;
##  1 0.688959
##  2 0.617087
##  3 0.603602
##  4 0.339257
##  5 0.647904
##  6 0.380529
##  7 0.647904
##  8 0.268054
##  9 0.506680
## 10 0.688901
## # … with 20 more rows</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="no">site_data</span>$<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="no">xgb_predictions</span>$<span class="no">f1</span>

<span class="co"># plot site estimated occupancy probabilities</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">site_data</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">p1</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"modelled probabilities"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-12-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div id="expected-value-given-current-information" class="section level2">
<h2 class="hasAnchor">
<a href="#expected-value-given-current-information" class="anchor"></a>Expected value given current information</h2>
<p>After simulating and modelling the data, we will now examine the <em>expected value of the decision given current information</em>. This value represents the conservation value of the optimal spatial prioritization given current information, whilst accounting for uncertainty in the presence (and absence) of the conservation feature in each site. Specifically, “current information” refers to our existing survey data and our occupancy models. Next, we will set a total budget (i.e. <code>total_budget</code>). This total budget represents the total amount of resources available for surveying sites and managing them for conservation. It will be set as 80% of the total site management costs.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate total budget for surveying and managing sites</span>
<span class="no">total_budget</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">site_data</span>$<span class="no">management_cost</span>) * <span class="fl">0.8</span>

<span class="co"># print total budget</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">total_budget</span>)</pre></body></html></div>
<pre><code>## [1] 1651.593</code></pre>
<p>Given the total budget, we can now calculate the <em>expected value of the decision given current information</em>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># expected value of the decision given current information</span>
<span class="no">evd_current</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evdci.html">evdci</a></span>(
  <span class="kw">site_data</span> <span class="kw">=</span> <span class="no">site_data</span>,
  <span class="kw">feature_data</span> <span class="kw">=</span> <span class="no">feature_data</span>,
  <span class="kw">site_detection_columns</span> <span class="kw">=</span> <span class="st">"f1"</span>,
  <span class="kw">site_n_surveys_columns</span> <span class="kw">=</span> <span class="st">"n1"</span>,
  <span class="kw">site_probability_columns</span> <span class="kw">=</span> <span class="st">"p1"</span>,
  <span class="kw">site_management_cost_column</span> <span class="kw">=</span> <span class="st">"management_cost"</span>,
  <span class="kw">feature_survey_sensitivity_column</span> <span class="kw">=</span> <span class="st">"survey_sensitivity"</span>,
  <span class="kw">feature_survey_specificity_column</span> <span class="kw">=</span> <span class="st">"survey_specificity"</span>,
  <span class="kw">feature_model_sensitivity_column</span> <span class="kw">=</span> <span class="st">"model_sensitivity"</span>,
  <span class="kw">feature_model_specificity_column</span> <span class="kw">=</span> <span class="st">"model_specificity"</span>,
  <span class="kw">feature_target_column</span> <span class="kw">=</span> <span class="st">"target"</span>,
  <span class="kw">total_budget</span> <span class="kw">=</span> <span class="no">total_budget</span>)

<span class="co"># print value</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">evd_current</span>)</pre></body></html></div>
<pre><code>## [1] 0.7236256</code></pre>
<p>We can potentially improve the <em>expected value of the decision given current information</em> by learning more about which sites are more likely (and less likely) to contain the conservation feature.</p>
</div>
<div id="survey-schemes" class="section level2">
<h2 class="hasAnchor">
<a href="#survey-schemes" class="anchor"></a>Survey schemes</h2>
<p>Now we will generate some candidate survey schemes to see if we can improve the management decision. To achieve this, we will set a budget for surveying additional sites. Specifically, this survey budget (i.e. <code>survey_budget</code>) will be set as 40% of the survey costs for the unsurveyed sites. Note that our total budget must always be greater than or equal to the survey budget.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate budget for surveying sites</span>
<span class="co">#   add column to site_data indicating if the sites already have data or not</span>
<span class="no">site_data</span>$<span class="no">surveyed</span> <span class="kw">&lt;-</span> <span class="no">site_data</span>$<span class="no">n1</span> <span class="kw">&gt;</span> <span class="fl">0.5</span>

<span class="co">#   add column to site_data containing the additional survey costs,</span>
<span class="co">#   i.e. sites that already have data have a zero cost, and</span>
<span class="co">#   sites that are missing data retain their cost values</span>
<span class="no">site_data</span> <span class="kw">&lt;-</span>
  <span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">new_survey_cost</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(<span class="no">surveyed</span>, <span class="fl">0</span>, <span class="no">survey_cost</span>))

<span class="co">#   calculate total cost of surveying remaining unsurveyed sites</span>
<span class="no">total_cost_of_surveying_remaining_sites</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">site_data</span>$<span class="no">new_survey_cost</span>)

<span class="co">#   calculate budget for surveying sites</span>
<span class="no">survey_budget</span> <span class="kw">&lt;-</span> <span class="no">total_cost_of_surveying_remaining_sites</span> * <span class="fl">0.4</span>

<span class="co"># print budgets</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">survey_budget</span>)</pre></body></html></div>
<pre><code>## [1] 34.13683</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">total_budget</span>)</pre></body></html></div>
<pre><code>## [1] 1651.593</code></pre>
<p>We will generate survey schemes by selecting unsurveyed sites that (i) increase geographic coverage among surveyed sites, (ii) increase coverage of environmental conditions among surveyed sites <span class="citation">(i.e. environmental diversity; Faith &amp; Walker 1996)</span>, (iii) select unsurveyed site with highly uncertain modelled predictions (i.e. modelled probabilities close to 0.5), (iv) increase coverage of sites that have low management costs, and (v) increase coverage of sites with high modelled probabilities of occupancy (i.e. predicted site richness).</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># (i) generate survey scheme to increase geographic coverage</span>
<span class="no">geo_scheme</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/geo_cov_survey_scheme.html">geo_cov_survey_scheme</a></span>(
    <span class="no">site_data</span>, <span class="st">"new_survey_cost"</span>, <span class="no">survey_budget</span>, <span class="kw">locked_out</span> <span class="kw">=</span> <span class="st">"surveyed"</span>)

<span class="co"># (ii) generate survey scheme to increase environmental diversity,</span>
<span class="co"># environmental distances are calculated using Euclidean distances here,</span>
<span class="co"># though we might consider something like Mahalanobis distances for a</span>
<span class="co"># real dataset to account for correlations among environmental variables)</span>
<span class="no">env_scheme</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/env_div_survey_scheme.html">env_div_survey_scheme</a></span>(
    <span class="no">site_data</span>, <span class="st">"new_survey_cost"</span>, <span class="no">survey_budget</span>, <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"e1"</span>, <span class="st">"e2"</span>, <span class="st">"e3"</span>),
    <span class="kw">locked_out</span> <span class="kw">=</span> <span class="st">"surveyed"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"euclidean"</span>)

<span class="co"># (iii) generate survey scheme using site uncertainty scores</span>
<span class="co"># calculate site uncertainty scores</span>
<span class="no">site_data</span>$<span class="no">uncertainty_score</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/relative_site_uncertainty_scores.html">relative_site_uncertainty_scores</a></span>(<span class="no">site_data</span>, <span class="st">"p1"</span>)

<span class="co"># generate survey scheme</span>
<span class="no">unc_scheme</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/weighted_survey_scheme.html">weighted_survey_scheme</a></span>(
    <span class="no">site_data</span>, <span class="st">"new_survey_cost"</span>, <span class="no">survey_budget</span>, <span class="st">"uncertainty_score"</span>,
    <span class="kw">locked_out</span> <span class="kw">=</span> <span class="st">"surveyed"</span>)

<span class="co"># (iv) generate survey scheme using site management cheapness</span>
<span class="co"># (i.e. inverse management cost)</span>
<span class="no">site_data</span>$<span class="no">inv_management_cost</span> <span class="kw">&lt;-</span> <span class="fl">1</span> / <span class="no">site_data</span>$<span class="no">management_cost</span>
<span class="no">cheap_scheme</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/weighted_survey_scheme.html">weighted_survey_scheme</a></span>(
    <span class="no">site_data</span>, <span class="st">"new_survey_cost"</span>, <span class="no">survey_budget</span>, <span class="st">"inv_management_cost"</span>,
    <span class="kw">locked_out</span> <span class="kw">=</span> <span class="st">"surveyed"</span>)

<span class="co"># (v) generate survey scheme using site richness scores</span>
<span class="co"># calculate site richness scores</span>
<span class="no">site_data</span>$<span class="no">richness_score</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/relative_site_richness_scores.html">relative_site_richness_scores</a></span>(<span class="no">site_data</span>, <span class="st">"p1"</span>)

<span class="co"># generate survey scheme</span>
<span class="no">rich_scheme</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/weighted_survey_scheme.html">weighted_survey_scheme</a></span>(
    <span class="no">site_data</span>, <span class="st">"new_survey_cost"</span>, <span class="no">survey_budget</span>, <span class="st">"richness_score"</span>,
    <span class="kw">locked_out</span> <span class="kw">=</span> <span class="st">"surveyed"</span>)</pre></body></html></div>
<p>Let’s visualize the different survey schemes.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># add schemes to site_data</span>
<span class="no">site_data</span>$<span class="no">geo_scheme</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="no">geo_scheme</span>)
<span class="no">site_data</span>$<span class="no">env_scheme</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="no">env_scheme</span>)
<span class="no">site_data</span>$<span class="no">unc_scheme</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="no">unc_scheme</span>)
<span class="no">site_data</span>$<span class="no">cheap_scheme</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="no">cheap_scheme</span>)
<span class="no">site_data</span>$<span class="no">rich_scheme</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="no">rich_scheme</span>)

<span class="co"># plot the schemes</span>
<span class="no">site_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://tidyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"scheme"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="no">name</span>, <span class="no">value</span>, -<span class="no">geometry</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span>(<span class="no">is.logical</span>, <span class="no">as.character</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">name</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">name</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">value</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">name</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">2</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>))</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-20-1.png" width="604.8" style="display: block; margin: auto;"></p>
<p>We can see that different approaches yield different survey schemes – but which survey scheme is the best?</p>
</div>
<div id="expected-value-of-the-decision-given-the-candidate-survey-schemes" class="section level2">
<h2 class="hasAnchor">
<a href="#expected-value-of-the-decision-given-the-candidate-survey-schemes" class="anchor"></a>Expected value of the decision given the candidate survey schemes</h2>
<p>Now that we’ve generated the survey schemes, let’s calculate the <em>expected value of the decision of each survey scheme</em>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># create table to store results</span>
<span class="no">evd_survey_schemes</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"geo_scheme"</span>, <span class="st">"env_scheme"</span>, <span class="st">"unc_scheme"</span>, <span class="st">"cheap_scheme"</span>,
                  <span class="st">"rich_scheme"</span>))

<span class="co"># expected value of the decision given each survey scheme</span>
<span class="no">evd_survey_schemes</span>$<span class="no">value</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(
  <span class="no">evd_survey_schemes</span>$<span class="no">name</span>, <span class="kw">function</span>(<span class="no">x</span>) {
    <span class="fu"><a href="../reference/evdsi.html">evdsi</a></span>(
      <span class="kw">site_data</span> <span class="kw">=</span> <span class="no">site_data</span>,
      <span class="kw">feature_data</span> <span class="kw">=</span> <span class="no">feature_data</span>,
      <span class="kw">site_detection_columns</span> <span class="kw">=</span> <span class="st">"f1"</span>,
      <span class="kw">site_n_surveys_columns</span> <span class="kw">=</span> <span class="st">"n1"</span>,
      <span class="kw">site_probability_columns</span> <span class="kw">=</span> <span class="st">"p1"</span>,
      <span class="kw">site_survey_scheme_column</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">x</span>),
      <span class="kw">site_management_cost_column</span> <span class="kw">=</span> <span class="st">"management_cost"</span>,
      <span class="kw">site_survey_cost_column</span> <span class="kw">=</span> <span class="st">"survey_cost"</span>,
      <span class="kw">feature_survey_column</span> <span class="kw">=</span> <span class="st">"survey"</span>,
      <span class="kw">feature_survey_sensitivity_column</span> <span class="kw">=</span> <span class="st">"survey_sensitivity"</span>,
      <span class="kw">feature_survey_specificity_column</span> <span class="kw">=</span> <span class="st">"survey_specificity"</span>,
      <span class="kw">feature_model_sensitivity_column</span> <span class="kw">=</span> <span class="st">"model_sensitivity"</span>,
      <span class="kw">feature_model_specificity_column</span> <span class="kw">=</span> <span class="st">"model_specificity"</span>,
      <span class="kw">feature_target_column</span> <span class="kw">=</span> <span class="st">"target"</span>,
      <span class="kw">total_budget</span> <span class="kw">=</span> <span class="no">total_budget</span>)
})

<span class="co"># print values</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">evd_survey_schemes</span>)</pre></body></html></div>
<pre><code>## # A tibble: 5 x 2
##   name            value
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 geo_scheme   0.723626
## 2 env_scheme   0.723626
## 3 unc_scheme   0.723626
## 4 cheap_scheme 0.723626
## 5 rich_scheme  0.723626</code></pre>
<p>We can also calculate how much the information gained from each of the survey schemes is expected to improve the management decision. This quantity is called the <em>return on investment</em> for each survey scheme.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># estimate the return on investment for each survey scheme</span>
<span class="no">evd_survey_schemes</span>$<span class="no">roi</span> <span class="kw">&lt;-</span>
  <span class="no">evd_survey_schemes</span>$<span class="no">value</span> - <span class="no">evd_current</span>

<span class="co"># print values</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">evd_survey_schemes</span>)</pre></body></html></div>
<pre><code>## # A tibble: 5 x 3
##   name            value          roi
##   &lt;chr&gt;           &lt;dbl&gt;        &lt;dbl&gt;
## 1 geo_scheme   0.723626 -5.46341e-12
## 2 env_scheme   0.723626 -1.96900e-11
## 3 unc_scheme   0.723626 -1.96897e-11
## 4 cheap_scheme 0.723626 -1.96897e-11
## 5 rich_scheme  0.723626 -1.96897e-11</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># visualize the return on investment for each survey scheme</span>
<span class="co"># color the best survey scheme in blue</span>
<span class="no">evd_survey_schemes</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">name</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="no">name</span>),
         <span class="kw">is_best</span> <span class="kw">=</span> <span class="no">roi</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">max</a></span>(<span class="no">roi</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">name</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">roi</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">is_best</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">is_best</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Survey scheme"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Return on investment"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"#3366FF"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"#3366FF"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">angle</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">0.65</span>),
          <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-22-1.png" width="700" style="display: block; margin: auto;"></p>
<p>In this particular simulation, we can see that all of the survey schemes have a very low return on investment (i.e. most values are very close to zero). This means that none of these survey schemes would likely lead to a substantially better conservation outcome when considering the funds spent conducting them. So, we would not choose to implement any of these surveys schemes. But what is the best possible – the optimal – survey scheme?</p>
</div>
<div id="optimal-survey-scheme" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-survey-scheme" class="anchor"></a>Optimal survey scheme</h2>
<p>Now let’s identify the optimal survey scheme by directly maximizing the <em>expected value of the decision given a survey scheme</em>.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># identify optimal survey scheme(s)</span>
<span class="no">opt_scheme</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/optimal_survey_scheme.html">optimal_survey_scheme</a></span>(
    <span class="kw">site_data</span> <span class="kw">=</span> <span class="no">site_data</span>,
    <span class="kw">feature_data</span> <span class="kw">=</span> <span class="no">feature_data</span>,
    <span class="kw">site_detection_columns</span> <span class="kw">=</span> <span class="st">"f1"</span>,
    <span class="kw">site_n_surveys_columns</span> <span class="kw">=</span> <span class="st">"n1"</span>,
    <span class="kw">site_probability_columns</span> <span class="kw">=</span> <span class="st">"p1"</span>,
    <span class="kw">site_management_cost_column</span> <span class="kw">=</span> <span class="st">"management_cost"</span>,
    <span class="kw">site_survey_cost_column</span> <span class="kw">=</span> <span class="st">"survey_cost"</span>,
    <span class="kw">feature_survey_column</span> <span class="kw">=</span> <span class="st">"survey"</span>,
    <span class="kw">feature_survey_sensitivity_column</span> <span class="kw">=</span> <span class="st">"survey_sensitivity"</span>,
    <span class="kw">feature_survey_specificity_column</span> <span class="kw">=</span> <span class="st">"survey_specificity"</span>,
    <span class="kw">feature_model_sensitivity_column</span> <span class="kw">=</span> <span class="st">"model_sensitivity"</span>,
    <span class="kw">feature_model_specificity_column</span> <span class="kw">=</span> <span class="st">"model_specificity"</span>,
    <span class="kw">feature_target_column</span> <span class="kw">=</span> <span class="st">"target"</span>,
    <span class="kw">total_budget</span> <span class="kw">=</span> <span class="no">total_budget</span>,
    <span class="kw">survey_budget</span> <span class="kw">=</span> <span class="no">total_budget</span>,
    <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># print number of optimal survey schemes</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">opt_scheme</span>))</pre></body></html></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># add optimal scheme to site data</span>
<span class="no">site_data</span>$<span class="no">opt_scheme</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="no">opt_scheme</span>[<span class="fl">1</span>, ])

<span class="co"># plot optimal scheme</span>
<span class="no">site_data</span> <span class="kw">%&gt;%</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"opt_scheme"</span>) <span class="kw">%&gt;%</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">opt_scheme</span>)) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">name</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>) +
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>))</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-24-1.png" width="504" style="display: block; margin: auto;"></p>
<p>We can see that the optimal survey scheme (<code>opt_scheme</code>) is different to the previous survey schemes. In particular, the optimal scheme selects fewer sites than the other survey schemes. This result shows that survey schemes need to ensure adequate funds remain for actually achieving conservation objectives.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># calculate return on investment of the optimal scheme</span>
<span class="no">evd_opt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/evdsi.html">evdsi</a></span>(
    <span class="kw">site_data</span> <span class="kw">=</span> <span class="no">site_data</span>,
    <span class="kw">feature_data</span> <span class="kw">=</span> <span class="no">feature_data</span>,
    <span class="kw">site_detection_columns</span> <span class="kw">=</span> <span class="st">"f1"</span>,
    <span class="kw">site_n_surveys_columns</span> <span class="kw">=</span> <span class="st">"n1"</span>,
    <span class="kw">site_probability_columns</span> <span class="kw">=</span> <span class="st">"p1"</span>,
    <span class="kw">site_survey_scheme_column</span> <span class="kw">=</span> <span class="st">"opt_scheme"</span>,
    <span class="kw">site_management_cost_column</span> <span class="kw">=</span> <span class="st">"management_cost"</span>,
    <span class="kw">site_survey_cost_column</span> <span class="kw">=</span> <span class="st">"survey_cost"</span>,
    <span class="kw">feature_survey_column</span> <span class="kw">=</span> <span class="st">"survey"</span>,
    <span class="kw">feature_survey_sensitivity_column</span> <span class="kw">=</span> <span class="st">"survey_sensitivity"</span>,
    <span class="kw">feature_survey_specificity_column</span> <span class="kw">=</span> <span class="st">"survey_specificity"</span>,
    <span class="kw">feature_model_sensitivity_column</span> <span class="kw">=</span> <span class="st">"model_sensitivity"</span>,
    <span class="kw">feature_model_specificity_column</span> <span class="kw">=</span> <span class="st">"model_specificity"</span>,
    <span class="kw">feature_target_column</span> <span class="kw">=</span> <span class="st">"target"</span>,
    <span class="kw">total_budget</span> <span class="kw">=</span> <span class="no">total_budget</span>)

<span class="co"># calculate value</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">evd_opt</span>)</pre></body></html></div>
<pre><code>## [1] 0.7236256</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># append optimal results to results table</span>
<span class="no">evd_survey_schemes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(
  <span class="no">evd_survey_schemes</span>,
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/reexports.html">tibble</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"opt_scheme"</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">evd_opt</span>, <span class="kw">roi</span> <span class="kw">=</span> <span class="no">evd_opt</span> - <span class="no">evd_current</span>))

<span class="co"># print updated results table</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">evd_survey_schemes</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 3
##   name            value          roi
##   &lt;chr&gt;           &lt;dbl&gt;        &lt;dbl&gt;
## 1 geo_scheme   0.723626 -5.46341e-12
## 2 env_scheme   0.723626 -1.96900e-11
## 3 unc_scheme   0.723626 -1.96897e-11
## 4 cheap_scheme 0.723626 -1.96897e-11
## 5 rich_scheme  0.723626 -1.96897e-11
## 6 opt_scheme   0.723626  2.84532e-11</code></pre>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># visualize return on investment values</span>
<span class="co"># color the best survey scheme in blue</span>
<span class="no">evd_survey_schemes</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">name</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="no">name</span>),
         <span class="kw">is_best</span> <span class="kw">=</span> <span class="no">roi</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">max</a></span>(<span class="no">roi</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">name</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">roi</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">is_best</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">is_best</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Survey scheme"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Return on investment"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"#3366FF"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"#3366FF"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">angle</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">0.65</span>),
          <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-26-1.png" width="504" style="display: block; margin: auto;"></p>
<p>We can see that the optimal survey scheme has the highest <em>return on investment</em> of all the candidate survey schemes. To understand how sub-optimal the candidate survey schemes actually are, let’s compute their relative optimality and visualize them.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="co"># express values in terms of optimality</span>
<span class="no">evd_survey_schemes</span>$<span class="no">optimality</span> <span class="kw">&lt;-</span>
  ((<span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">max</a></span>(<span class="no">evd_survey_schemes</span>$<span class="no">roi</span>) - <span class="no">evd_survey_schemes</span>$<span class="no">roi</span>) /
   <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">max</a></span>(<span class="no">evd_survey_schemes</span>$<span class="no">roi</span>)) * <span class="fl">100</span>

<span class="co"># visualize relative optimality</span>
<span class="co"># zero = optimal, and increasing values indicate greater sub-optimality</span>
<span class="no">evd_survey_schemes</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">name</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="no">name</span>),
         <span class="kw">optimality</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">abs</a></span>(<span class="no">optimality</span>),
         <span class="kw">is_best</span> <span class="kw">=</span> <span class="no">optimality</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">min</a></span>(<span class="no">optimality</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">name</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">optimality</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">is_best</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">is_best</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Survey scheme"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Optimality gap (%)"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"#3366FF"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span>(<span class="st">"TRUE"</span> <span class="kw">=</span> <span class="st">"#3366FF"</span>, <span class="st">"FALSE"</span> <span class="kw">=</span> <span class="st">"black"</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">axis.text.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span>(<span class="kw">angle</span> <span class="kw">=</span> <span class="fl">30</span>, <span class="kw">vjust</span> <span class="kw">=</span> <span class="fl">0.65</span>),
          <span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>)</pre></body></html></div>
<p><img src="simulation_files/figure-html/unnamed-chunk-27-1.png" width="504" style="display: block; margin: auto;"></p>
<p>We can see that the optimal survey scheme performs much better than all the other survey schemes. This result shows that value of information analyses can potentially improve management decisions by strategically allocating funds to surveys and conservation management.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-r2">
<p>Faith, D.P. &amp; Walker, P. (1996). Environmental diversity: On the best-possible use of surrogate data for assessing the relative biodiversity of sets of areas. <em>Biodiversity &amp; Conservation</em>, <em>5</em>, 399–415.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://jeffrey-hanson.com">Jeffrey O Hanson</a>, <a href="https://josephrbennett.wordpress.com">Joseph Bennett</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
