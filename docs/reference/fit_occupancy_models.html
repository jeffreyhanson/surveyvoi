<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit models to estimate probability of occupancy — fit_occupancy_models • surveyvoi</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit models to estimate probability of occupancy — fit_occupancy_models" />
<meta property="og:description" content="Estimate probability of occupancy for a set of features in a set of
planning units." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">surveyvoi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/approximation.html">Approximation Benchmark</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulation Study</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jeffreyhanson/surveyvoi">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit models to estimate probability of occupancy</h1>
    <small class="dont-index">Source: <a href='https://github.com/jeffreyhanson/surveyvoi/blob/master/R/fit_occupancy_models.R'><code>R/fit_occupancy_models.R</code></a></small>
    <div class="hidden name"><code>fit_occupancy_models.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimate probability of occupancy for a set of features in a set of
planning units.</p>
    </div>

    <pre class="usage"><span class='fu'>fit_occupancy_models</span>(<span class='no'>site_data</span>, <span class='no'>site_occupancy_columns</span>,
  <span class='no'>site_env_vars_columns</span>, <span class='no'>parameters</span>, <span class='kw'>n_folds</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/ifelse'>ifelse</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>nrow</a></span>(<span class='no'>site_data</span>)
  <span class='kw'>&gt;</span> <span class='fl'>1000</span>, <span class='fl'>10</span>, <span class='fl'>5</span>), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>site_occupancy_columns</span>)),
  <span class='kw'>site_weight_columns</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>n_threads</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>site_data</th>
      <td><p><code><a href='https://www.rdocumentation.org/packages/sf/topics/sf'>sf</a></code> object with site data.</p></td>
    </tr>
    <tr>
      <th>site_occupancy_columns</th>
      <td><p><code>character</code> names of <code>numeric</code>
columns in the
argument to <code>site_data</code> that contain presence/absence data.
Each column should correspond to a different feature, and contain
binary presence/absence data (zeros or ones) indicating if the
feature was detected in a previous survey or not. If a site has not
been surveyed before, then missing (<code>NA</code>) values should be used.</p></td>
    </tr>
    <tr>
      <th>site_env_vars_columns</th>
      <td><p><code>character</code> names of columns in the
argument to <code>site_data</code> that contain environmental information
for fitting updated occupancy models based on possible survey outcomes.
Each column should correspond to a different environmental variable,
and contain <code>numeric</code>, <code>factor</code>, or <code>character</code> data.
No missing (<code>NA</code>) values are permitted in these columns.</p></td>
    </tr>
    <tr>
      <th>parameters</th>
      <td><p><code>list</code> of <code>list</code> objects containing the
parameters for fitting models for each
feature. Ideally, these parameters would be determined using the
<code>tune_occupancy_models</code> function. Note that arguments must
have a <code>nrounds</code> element (see example below).
Valid parameters include: <code>"max_depth"</code>, <code>"eta"</code>,
<code>"nrounds"</code>, <code>"lambda"</code>, <code>"subsample"</code>,
<code>"colsample_bytree"</code>, and <code>"objective"</code>.
See documentation for the <code>params</code> argument in
<code><a href='https://www.rdocumentation.org/packages/xgboost/topics/xgb.train'>xgb.train</a></code> for more information.</p></td>
    </tr>
    <tr>
      <th>n_folds</th>
      <td><p><code>numeric</code> number of folds to split the training
data into when fitting models for each feature.
Defaults to 10 if there are more than 1000
rows in the argument <code>site_data</code>, otherwise defaults to 5.
Note that if the maximum number of minority cases (e.g. 1 presence and
1000 absences) is fewer than the number of folds then one minority case
is sampled per fold.</p></td>
    </tr>
    <tr>
      <th>site_weight_columns</th>
      <td><p><code>character</code> name of columns in
<code>site_data</code> containing weights for model fitting. These columns must
contain <code>numeric</code> values. No missing (<code>NA</code>) values are
permitted. Defaults to <code>NULL</code> such that all data are given
equal weight when fitting models.</p></td>
    </tr>
    <tr>
      <th>n_threads</th>
      <td><p><code>integer</code> number of threads to use for fitting models.
Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p><code>logical</code> indicating if information should be
printed during computations. Defaults to <code>FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>list</code> object containing the following elements:</p><dl class='dl-horizontal'>
 <dt>predictions</dt><dd><p><code><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></code> with estimated
   probabilities of each feature occupying each site. Rows
   correspond to sites and columns correspond to features.</p></dd>
 <dt>performance</dt><dd><p><code><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></code> with model information.
   Each row corresponds to a different feature and column contain
   different information. Specifically, the columns contain:
   (<code>sensitivity</code>) model sensitivities,
   (<code>specificity</code>) model specificities, and
   (<code>auc</code>) model area under the curve (AUC) statistics.</p></dd>
 </dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The models are fitted using the specified tuning parameters and
 automatically calibrated <code>scale_pos_weight</code>
 <code><a href='https://www.rdocumentation.org/packages/xgboost/topics/xgb.train'>xgboost</a></code> parameters
 (i.e. number of absence divided by number of presences per feature)
 to account for unbalanced datasets. After the models are fitted, they
 are used to make probability of occupancy predictions (via
 <code><a href='https://www.rdocumentation.org/packages/xgboost/topics/xgb.train'>xgboost</a></code>). The average sensitivity, specificity,
 and area under the curve (AUC) statistics are calculated using the data held
 are then reported to assess model performance. Note that each feature
 is run with the same seed to ensure reproducibility.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># set seed</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Random'>set.seed</a></span>(<span class='fl'>100</span>)

<span class='co'># simulate data for 200 sites, 2 features, and 3 environmental variables</span>
 <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>simulate_site_data</span>(<span class='fl'>200</span>, <span class='fl'>2</span>, <span class='fl'>0.5</span>, <span class='kw'>n_env_vars</span> <span class='kw'>=</span> <span class='fl'>3</span>)</div><div class='output co'>#&gt; ...</div><div class='input'>
<span class='co'># set parameters manually</span>
<span class='no'>xgb_params</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>nrounds</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>objective</span> <span class='kw'>=</span> <span class='st'>"binary:logistic"</span>),
                   <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>nrounds</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>objective</span> <span class='kw'>=</span> <span class='st'>"binary:logistic"</span>))

<span class='co'># fit models</span>
<span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_occupancy_models</span>(<span class='no'>x</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"f1"</span>, <span class='st'>"f2"</span>), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"e1"</span>, <span class='st'>"e2"</span>, <span class='st'>"e3"</span>),
                          <span class='no'>xgb_params</span>)

<span class='co'># preview results</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/str'>str</a></span>(<span class='no'>p</span>)</div><div class='output co'>#&gt; List of 2
#&gt;  $ predictions:Classes 'tbl_df', 'tbl' and 'data.frame':	200 obs. of  2 variables:
#&gt;   ..$ f1: num [1:200] 0.0405 0.0626 0.4685 0.0522 0.2935 ...
#&gt;   ..$ f2: num [1:200] 0.878 0.878 0.482 0.878 0.482 ...
#&gt;  $ performance:Classes 'tbl_df', 'tbl' and 'data.frame':	2 obs. of  12 variables:
#&gt;   ..$ train_auc_mean        : num [1:2] 1 0.998
#&gt;   ..$ train_auc_std         : num [1:2] 0.000663 0.000864
#&gt;   ..$ train_sensitivity_mean: num [1:2] 0.988 0.975
#&gt;   ..$ train_sensitivity_std : num [1:2] 0.0172 0.0354
#&gt;   ..$ train_specificity_mean: num [1:2] 0.987 0.978
#&gt;   ..$ train_specificity_std : num [1:2] 0.0181 0.0307
#&gt;   ..$ test_auc_mean         : num [1:2] 0.953 0.995
#&gt;   ..$ test_auc_std          : num [1:2] 0.06629 0.00737
#&gt;   ..$ test_sensitivity_mean : num [1:2] 0.808 0.917
#&gt;   ..$ test_sensitivity_std  : num [1:2] 0.0825 0.1179
#&gt;   ..$ test_specificity_mean : num [1:2] 0.958 0.875
#&gt;   ..$ test_specificity_std  : num [1:2] 0.0589 0.1768</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://jeffrey-hanson.com'>Jeffrey O Hanson</a>, <a href='https://josephrbennett.wordpress.com'>Joseph Bennett</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

